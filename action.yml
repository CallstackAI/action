name: 'Callstack.ai Reviewer'
description: 'Run Callstack.ai reviewer'
inputs:
  config:
    description: 'Config for reviewer'
    required: true
  head:
    description: 'Head commit sha'
    required: true
  openai_key:
    description: 'OpenAI key'
    required: false

runs:
  using: composite
  steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.head }}

    - name: Run reviewer
      uses: addnab/docker-run-action@v3
      with:
        image: callstackai/cal:latest
        options: -v ${{ github.workspace }}:/code
        env:
          OPENAI_KEY: ${{ inputs.openai_key }}
        run: |
          /reviewer \
          --dir /code \
          --id ${{ github.run_id }} \
          --token ${{ github.token }} \
          --config "${{ inputs.config }}"
